const request=async(e,t="GET",o=null,c={"Content-type":"application/json; charset=UTF-8"})=>{try{const r=await fetch(e,{method:t,body:o,headers:c});if(!r.ok)throw new Error(`Could not fetch ${e}, status: ${r.status}`);return await r.json()}catch(e){throw e}};let todoParrent=document.querySelector(".todo"),form=document.querySelector(".add-todo"),input=document.querySelector(".add-todo__import"),button=document.querySelector(".add-todo__button");const createTodo=e=>{const t=JSON.parse(localStorage.getItem("todo"))?JSON.parse(localStorage.getItem("todo")):[];let o={};const c=(e,t,c)=>{const r=document.createElement("li");r.classList.add("todo__item","show"),c&&r.classList.add("checked"),r.id=e;const s=document.createElement("div");s.classList.add("checkbox-wrapper"),s.innerHTML=c?`<input id=${e} type="checkbox" class="checkbox" id="checkbox${e}" checked> <label for="checkbox${e}">${t}</label>`:`<input id=${e} type="checkbox" class="checkbox" id="checkbox${e}"> <label for="checkbox${e}">${t}</label>`;const d=document.createElement("button");d.classList.add("todo__item-remov"),d.innerHTML='<img src="./img/remove.svg">',d.id=e,r.appendChild(s),r.appendChild(d),todoParrent.appendChild(r),o={id:e,title:t,completed:c}};if("object"==typeof e)return e.map((e=>{let t=e.title,o=e.id,r=e.completed;return c(o,t,r),e}));{let t=Math.floor(996*Math.random())+5;c(t,e,!1)}t.push(o),localStorage.setItem("todo",JSON.stringify(t)),checkedTodo(),deleteTodo(),sortTodo()},createUserTodo=()=>{form.addEventListener("submit",(e=>{e.preventDefault(),input.value.length>0&&createTodo(input.value),input.value=""}))};form.addEventListener("submit",(e=>{e.preventDefault(),input.value.length>0&&createTodo(input.value),input.value=""}));const createLocalStorageTodo=()=>{const e=JSON.parse(localStorage.getItem("todo"));e&&createTodo(e)};createLocalStorageTodo();const deleteTodo=()=>{let e=document.querySelectorAll(".todo__item"),t=document.querySelectorAll(".todo__item-remov");for(let o of t)o.addEventListener("click",(()=>{e.forEach((e=>{o.id==e.id&&e.remove()}));let t=JSON.parse(localStorage.getItem("todo"));t&&t.forEach((e=>{if(e.id==o.id){let o=t.indexOf(e);return t.splice(o,1)}})),localStorage.setItem("todo",JSON.stringify(t))}))},checkedTodo=()=>{let e=[...document.querySelectorAll(".todo__item")],t=[...document.querySelectorAll(".checkbox")];e.forEach((e=>{e.addEventListener("click",(()=>{e.classList.toggle("checked"),t.forEach((t=>{t.id===e.id&&t.toggleAttribute("checked")}));let o=JSON.parse(localStorage.getItem("todo"));o&&(o.map((t=>{e.id==t.id&&(t.completed=!t.completed)})),localStorage.setItem("todo",JSON.stringify(o)))}))}))},sortingVariants=[{title:"Все",id:"all"},{title:"Выполненные",id:"made"},{title:"В работе",id:"in-work"}];let checkMark=document.createElement("img"),sortList=document.querySelector(".sorting__list");checkMark.setAttribute("src","./img/check-mark.svg"),sortingVariants.forEach((e=>{const t=document.createElement("div");t.classList.add("sorting__item"),t.innerHTML=e.title,t.id=e.id,"all"==t.id&&(t.classList.add("active"),t.appendChild(checkMark)),sortList.appendChild(t)}));const openSortListButton=document.querySelector(".sorting__open-button"),sortListHeader=document.querySelector(".sorting__header"),toggleSortMenu=()=>{openSortListButton.classList.toggle("active"),sortList.classList.toggle("show-menu")};sortListHeader.addEventListener("click",(()=>{openSortListButton.classList.toggle("active"),sortList.classList.toggle("show-menu")}));let activeFilterTitle=document.querySelector(".sorting__active-filter");const activeFilter=()=>{let e=document.querySelectorAll(".sorting__item");sortList.addEventListener("click",(t=>{let o=t.target;for(let t=0;t<e.length;t++)e[t].classList.remove("active");activeFilterTitle.innerHTML=o.firstChild.data,o.classList.add("active"),o.appendChild(checkMark)}))};activeFilter();const sortTodo=()=>{const e=document.querySelectorAll(".todo__item");document.querySelectorAll(".sorting__item").forEach((t=>{t.addEventListener("click",(()=>{if("all"==t.id)for(let t of e)t.classList.add("show");if("made"==t.id)for(let t of e)t.classList.contains("checked")?t.classList.add("show"):t.classList.remove("show");if("in-work"==t.id)for(let t of e)t.classList.contains("checked")?t.classList.remove("show"):t.classList.add("show")}))}))},popupWrapper=document.querySelector(".user__popap-wrapper"),popup=document.querySelector(".user__popap"),popupOpenButton=document.querySelector(".logo__popup-open-button"),popupCloseButton=document.querySelector(".user__close-button");popupOpenButton.addEventListener("click",(()=>{popupWrapper.classList.add("active"),popup.classList.add("active")}));const closePopup=()=>{popupWrapper.classList.remove("active"),popup.classList.remove("active")};popupCloseButton.addEventListener("click",(()=>{closePopup()})),document.addEventListener("keydown",(function(e){"Escape"===e.key&&closePopup()})),document.addEventListener("click",(function(e){e.target==popupWrapper&&closePopup()}));const receivingToDo=()=>{request("https://jsonplaceholder.typicode.com/todos?_page=1&_limit=5","GET").then((e=>{createTodo(e),checkedTodo(),deleteTodo(),sortTodo()}))};request("https://jsonplaceholder.typicode.com/todos?_page=1&_limit=5","GET").then((e=>{createTodo(e),checkedTodo(),deleteTodo(),sortTodo()}));